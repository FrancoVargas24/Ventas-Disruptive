<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Disruptive Stickers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="iconos/LOGO + sombra.png">
  <link rel="stylesheet" href="css/estilos_v4.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://elfsightcdn.com/platform.js" async></script>
  <script src="script_v3.js" defer></script>
</head>

<body>
  <header style="background-color: #ffffff29;">
    <section style="margin: -10px 0;">
      <p style="margin: 0px;font-size: 15px;">Tiempos de entrega 10 d√≠as h√°biles</p>
    </section>
  </header>
  <nav class="navbar">
    <div class="navbar-logo">
      <a href="https://disruptivestickers.com.ar/"><img src="iconos/LOGO + sombra.png" alt="Logo" /></a>
    </div>
    <button class="navbar-toggle" id="navbar-toggle">&#9776;</button>
    <ul class="navbar-links" id="navbar-links">
      <li><a href="subCategoria.html">Categor√≠as</a></li>
      <li><a href="personalizado.html">Personalizados</a></li>
      <li><a href="seguridadehigiene.html">Seguridad e higiene</a></li>
      <li><a href="#contacto">Contacto</a></li>
      <li><a href="nosotros.html">Nosotros</a></li>
    </ul>
    <div class="navbar-user">
      <button class="carrito-btn" onclick="window.location.href='carrito.html'"><img src="iconos/carrito.png"
          alt=""></button>
    </div>
  </nav>

  <main style="min-height: 600px;">

    <div style="display: flex;" class="contenedor">

      <h2 class="categoria-titulo" id="categoria-titulo">Carrito</h2>
      <button class="botonWhatsApp" onclick="vaciarCarrito()" style="margin-top:10px; background:#a83232;">
        üóë Vaciar carrito
      </button>

    </div>

    <div class="productos-container">
      <div class="productos-container" id="carrito-contenido">
      </div>
    </div>
    <div class="cart-timeline">
      <div id="carrito-total" style="font-size: 130%;"></div>
      <button class="botonWhatsApp" onclick="enviarPorWhatsApp()" style="margin-top:10px;"><img src="iconos/wp.png"
          alt="">Enviar pedido por WhatsApp</button>
    </div>

  </main>
  <div id="footer-placeholder"></div>

  <script>
    // üîπ VARIABLES LOCALES (copiadas de script_v3.js)
    let carrito = {};
    const precioBase = 400;
    const precioDescuento20 = 350;
    const precioDescuento50 = 300;

    // üîπ CARGAR CARRITO DESDE LOCALSTORAGE
    function cargarCarrito() {
      const carritoGuardado = localStorage.getItem('carrito');
      if (carritoGuardado) {
        try {
          carrito = JSON.parse(carritoGuardado);
        } catch (e) {
          console.error('Error al cargar carrito:', e);
          carrito = {};
        }
      }
    }

    // üîπ GUARDAR CARRITO EN LOCALSTORAGE
    function guardarCarrito() {
      try {
        localStorage.setItem('carrito', JSON.stringify(carrito));
      } catch (e) {
        console.error('Error al guardar carrito:', e);
      }
    }

    // üîπ FUNCI√ìN ESPEC√çFICA PARA VACIAR CARRITO
    function vaciarCarrito() {
      if (confirm("¬øEst√° seguro que quiere vaciar todo el carrito?")) {
        carrito = {};
        guardarCarrito();
        actualizarVistaCarrito();
      }
    }

    // üîπ CALCULAR TOTAL
    function calcularTotal() {
      const cantidadTotal = Object.values(carrito).reduce((a, b) => a + b, 0);
      
      let precioUnitario;
      if (cantidadTotal >= 500) {
        precioUnitario = 250;
      } else if (cantidadTotal >= 50) {
        precioUnitario = precioDescuento50;
      } else if (cantidadTotal >= 20) {
        precioUnitario = precioDescuento20;
      } else {
        precioUnitario = precioBase;
      }

      const total = cantidadTotal * precioUnitario;

      document.getElementById('carrito-total').textContent =
        `Total: $${total} (${cantidadTotal} productos, $${precioUnitario} c/u)`;
    }

    // üîπ ACTUALIZAR VISTA DEL CARRITO (CORREGIDA)
function actualizarVistaCarrito() {
  const contenedor = document.getElementById('carrito-contenido');
  contenedor.innerHTML = '';

  // Si el carrito est√° vac√≠o
  if (Object.keys(carrito).length === 0) {
    contenedor.innerHTML = '<p style="text-align: center; color: #666; font-size: 18px; margin-top: 50px;">Tu carrito est√° vac√≠o</p>';
    document.getElementById('carrito-total').textContent = 'Total: $0 (0 productos)';
    return;
  }

  // Mostrar productos del carrito
  Object.entries(carrito).forEach(([codigo, cantidad]) => {
    const div = document.createElement('div');
    div.className = 'product-card';
    div.style.cssText = `
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin: 10px;
      text-align: center;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: inline-block;
      vertical-align: top;
      width: 160px;
    `;

    const img = document.createElement('img');
    img.src = 'stickers/' + codigo;
    img.alt = codigo;
    img.style.cssText = `
      width: 120px;
      height: auto;
      border-radius: 8px;
      margin-bottom: 8px;
    `;
    img.onerror = function() { 
      this.src = 'iconos/imagen-no-encontrada.png'; 
      this.style.opacity = '0.5';
    };

    // üîπ ELIMIN√â EL C√ìDIGO/NOMBRE DEL STICKER

    const cantidadSpan = document.createElement('span');
    cantidadSpan.textContent = `Cantidad: ${cantidad}`;
    cantidadSpan.style.cssText = `
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
      font-size: 14px;
    `;

    const controlesDiv = document.createElement('div');
    controlesDiv.style.cssText = `
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 5px;
    `;

    const btnMenos = document.createElement('button');
    btnMenos.textContent = '‚àí';
    btnMenos.style.cssText = `
      background: #f44336;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 32px;
      height: 32px;
    `;
    btnMenos.onclick = () => {
      carrito[codigo]--;
      if (carrito[codigo] <= 0) {
        delete carrito[codigo];
      }
      guardarCarrito();
      actualizarVistaCarrito();
    };

    const cantidadDisplay = document.createElement('span');
    cantidadDisplay.textContent = cantidad;
    cantidadDisplay.style.cssText = `
      min-width: 25px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      color: #333;
    `;

    const btnMas = document.createElement('button');
    btnMas.textContent = '+';
    btnMas.style.cssText = `
      background: #4CAF50;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 32px;
      height: 32px;
    `;
    btnMas.onclick = () => {
      carrito[codigo]++;
      guardarCarrito();
      actualizarVistaCarrito();
    };

    controlesDiv.appendChild(btnMenos);
    controlesDiv.appendChild(cantidadDisplay);
    controlesDiv.appendChild(btnMas);

    div.appendChild(img);
    div.appendChild(cantidadSpan);
    div.appendChild(controlesDiv);
    contenedor.appendChild(div);
  });

  calcularTotal();
}

    // üîπ FUNCI√ìN PARA ENVIAR POR WHATSAPP (copiada de script_v3.js)
    function enviarPorWhatsApp() {
      const cantidadTotal = Object.values(carrito).reduce((a, b) => a + b, 0);
      if (cantidadTotal === 0) {
        alert('El carrito est√° vac√≠o. Agreg√° stickers antes de enviar el pedido.');
        return;
      }
      const numero = '5491123935400';
      
      let precioUnitario;
      if (cantidadTotal >= 500) {
        precioUnitario = 250;
      } else if (cantidadTotal >= 50) {
        precioUnitario = precioDescuento50;
      } else if (cantidadTotal >= 20) {
        precioUnitario = precioDescuento20;
      } else {
        precioUnitario = precioBase;
      }

      const total = cantidadTotal * precioUnitario;

      // Generar n√∫mero de pedido √∫nico
      const ahora = new Date();
      const pedidoId = [
        ahora.getFullYear(),
        String(ahora.getMonth() + 1).padStart(2, '0'),
        String(ahora.getDate()).padStart(2, '0'),
        String(ahora.getHours()).padStart(2, '0'),
        String(ahora.getMinutes()).padStart(2, '0'),
        String(ahora.getSeconds()).padStart(2, '0')
      ].join('');

      const lista = Object.entries(carrito)
        .map(([codigo, cant]) => {
          const nombre = codigo.split('/').pop().replace(/\.[^/.]+$/, '');
          return `${nombre} x${cant}`;
        })
        .join('\n');

      const mensaje = `Hola! Quiero pedir:\n\nN√∫mero de pedido: ${pedidoId}\n\n${lista}\n\nCantidad total: ${cantidadTotal}\nPrecio unitario: $${precioUnitario}\nTotal: $${total}`;
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
    }

    // üîπ CARGAR FOOTER
    fetch('footer.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      })
      .catch(err => console.error('Error al cargar footer:', err));

    // üîπ NAVBAR TOGGLE
    document.getElementById('navbar-toggle').onclick = function () {
      document.getElementById('navbar-links').classList.toggle('active');
    };

    // üîπ INICIALIZAR AL CARGAR LA P√ÅGINA
    window.addEventListener('DOMContentLoaded', function() {
      cargarCarrito();
      actualizarVistaCarrito();
    });
  </script>
</body>

</html>