<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Disruptive Stickers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="iconos/LOGO + sombra.png">
  <link rel="stylesheet" href="css/estilos_v3.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://elfsightcdn.com/platform.js" async></script>
  <script src="script_v3.js" defer></script>
</head>

<body>
  <header style="background-color: #ffffff29;">
    <section style="margin: -10px 0;">
      <p style="margin: 0px;font-size: 15px;">Tiempos de entrega 10 dÃ­as hÃ¡biles</p>
    </section>
  </header>
  <nav class="navbar">
    <div class="navbar-logo">
      <a href="https://disruptivestickers.com.ar/"><img src="iconos/LOGO + sombra.png" alt="Logo" /></a>
    </div>
    <button class="navbar-toggle" id="navbar-toggle">&#9776;</button>
    <ul class="navbar-links" id="navbar-links">
      <li><a href="subCategoria.html">CategorÃ­as</a></li>
      <li><a href="personalizado.html">Personalizados</a></li>
      <li><a href="seguridadehigiene.html">Seguridad e higiene</a></li>
      <li><a href="#contacto">Contacto</a></li>
      <li><a href="nosotros.html">Nosotros</a></li>
    </ul>
    <div class="navbar-user">
      <button class="carrito-btn" onclick="window.location.href='carrito.html'"><img src="iconos/carrito.png"
          alt=""></button>
    </div>
  </nav>

  <main style="min-height: 600px;">

    <div style="display: flex;" class="contenedor">

      <h2 class="categoria-titulo" id="categoria-titulo">Carrito</h2>
      <button class="botonWhatsApp" onclick="vaciarCarrito()" style="margin-top:10px; background:#a83232;">
        ðŸ—‘ Vaciar carrito
      </button>

    </div>

    <div class="productos-container">
      <div class="productos-container" id="carrito-contenido">
      </div>
    </div>
    <div class="cart-timeline">
      <div id="carrito-total" style="font-size: 130%;"></div>
      <button class="botonWhatsApp" onclick="enviarPorWhatsApp()" style="margin-top:10px;"><img src="iconos/wp.png"
          alt="">Enviar pedido por WhatsApp</button>
    </div>
    </div>


  </main>
  <div id="footer-placeholder"></div>

  <script>
    function vaciarCarrito() {
      if (confirm("Â¿EstÃ¡ seguro que quiere vaciar todo el carrito?")) {
        carrito = {};               // vaciar objeto
        guardarCarrito();           // limpiar en localStorage
        actualizarVista();          // refrescar la vista
      }
    }


    fetch('footer.html') // o 'componentes/footer.html' si lo tenÃ©s en una carpeta
      .then(res => res.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      })
      .catch(err => console.error('Error al cargar footer:', err));



    document.getElementById('navbar-toggle').onclick = function () {
      document.getElementById('navbar-links').classList.toggle('active');
    };

    const precioBase = 400;
    const precioDescuento = 300;
    let carrito = JSON.parse(localStorage.getItem('carrito') || '{}');

    function guardarCarrito() {
      localStorage.setItem('carrito', JSON.stringify(carrito));
    }

    function calcularTotal() {
      const cantidadTotal = Object.values(carrito).reduce((a, b) => a + b, 0);
      const precioUnitario = cantidadTotal >= 500 ? 250 : (cantidadTotal >= 20 ? precioDescuento : precioBase);
      const total = cantidadTotal * precioUnitario;

      document.getElementById('carrito-total').textContent =
        `Total: $${total} (${cantidadTotal} productos, $${precioUnitario} c/u)`;
    }

    function actualizarVista() {
      const contenedor = document.getElementById('carrito-contenido');
      contenedor.innerHTML = '';

      Object.entries(carrito).forEach(([codigo, cantidad]) => {
        const div = document.createElement('div');
        div.className = 'product-card';

        const img = document.createElement('img');
        img.src = 'stickers/' + codigo;
        img.alt = codigo;

        const contador = document.createElement('div');
        contador.style.marginTop = '10px';

        const cantidadSpan = document.createElement('span');
        cantidadSpan.textContent = `Cantidad: ${cantidad}`;
        cantidadSpan.style.display = 'block';
        cantidadSpan.style.marginBottom = '8px';

        const btnMas = document.createElement('button');
        btnMas.textContent = '+';
        btnMas.style.marginRight = '10px';
        btnMas.onclick = () => {
          carrito[codigo]++;
          guardarCarrito();
          actualizarVista();
        };

        const btnMenos = document.createElement('button');
        btnMenos.textContent = 'âˆ’';
        btnMenos.onclick = () => {
          carrito[codigo]--;
          if (carrito[codigo] <= 0) {
            delete carrito[codigo];
          }
          guardarCarrito();
          actualizarVista();
        };

        contador.appendChild(cantidadSpan);
        contador.appendChild(btnMas);
        contador.appendChild(btnMenos);

        div.appendChild(img);
        div.appendChild(contador);
        contenedor.appendChild(div);
      });

      calcularTotal();
    }

    function enviarPorWhatsApp() {
      const cantidadTotal = Object.values(carrito).reduce((a, b) => a + b, 0);
      if (cantidadTotal === 0) {
        alert('El carrito estÃ¡ vacÃ­o. AgregÃ¡ stickers antes de enviar el pedido.');
        return;
      }
      const numero = '5491123935400';
      const precioUnitario = cantidadTotal >= 500 ? 250 : (cantidadTotal >= 20 ? precioDescuento : precioBase);
      const total = cantidadTotal * precioUnitario;

      // Generar nÃºmero de pedido Ãºnico
      const ahora = new Date();
      const pedidoId = [
        ahora.getFullYear(),
        String(ahora.getMonth() + 1).padStart(2, '0'),
        String(ahora.getDate()).padStart(2, '0'),
        String(ahora.getHours()).padStart(2, '0'),
        String(ahora.getMinutes()).padStart(2, '0'),
        String(ahora.getSeconds()).padStart(2, '0')
      ].join('');

      const lista = Object.entries(carrito)
        .map(([codigo, cant]) => {
          const nombre = codigo.split('/').pop().replace(/\.[^/.]+$/, '');
          return `${nombre} x${cant}`;
        })
        .join('\n');
      const mensaje = `Hola! Quiero pedir:\n\nNÃºmero de pedido: ${pedidoId}\n\n${lista}\n\nCantidad total: ${cantidadTotal}\nPrecio unitario: $${precioUnitario}\nTotal: $${total}`;
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
    }

    actualizarVista();
  </script>
</body>

</html>